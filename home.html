<!DOCTYPE html>
<html>
<head>
  <title>Word of the Day</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    .word { font-size: 2rem; font-weight: bold; margin: 20px 0; }
    .definition { font-size: 1.2rem; color: #444; margin-bottom: 30px; }
    .response-box { margin: 20px auto; width: 80%; max-width: 600px; }
    textarea { width: 100%; height: 100px; padding: 10px; font-size: 1rem; border-radius: 6px; border: 1px solid #ccc; margin-top: 5px; }
    select, button { margin-top: 10px; padding: 8px 12px; font-size: 1rem; }
    .history { margin-top: 40px; text-align: left; max-width: 700px; margin-left: auto; margin-right: auto; }
    .entry { border-bottom: 1px solid #ddd; padding: 10px 0; }
    .entry strong { display: block; margin-bottom: 5px; }
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <h1>Word of the Day</h1>
  <div class="word" id="wordBox">Loading...</div>
  <div class="definition" id="definition"></div>

  <!-- Shared response form -->
  <div class="response-box">
    <label for="nameSelect"><strong>Who are you?</strong></label>
    <select id="nameSelect">
      <option value="Selene">Selene</option>
      <option value="Angelica">Angelica</option>
    </select>

    <textarea id="responseInput" placeholder="Write your thoughts..."></textarea>
    <br>
    <button id="submitBtn">Submit</button>
  </div>

  <!-- History section -->
  <div class="history">
    <h2>Response History</h2>
    <div id="historyList"></div>
  </div>

  <script>
    // ðŸ”¹ Replace with your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCSIO3qjNhXbnwq9D_-L4jT8p1t1izqf9Y",
      authDomain: "nemoydemo.firebaseapp.com",
      projectId: "nemoydemo",
      storageBucket: "nemoydemo.firebasestorage.app",
      messagingSenderId: "396078882117",
      appId: "1:396078882117:web:82f885e49eb6d3c556722c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Get Word of the Day
    async function getWordOfTheDay() {
      try {
        const today = new Date().toISOString().split("T")[0];
        const saved = JSON.parse(localStorage.getItem("wordOfTheDay"));
        if (saved && saved.date === today) {
          displayWord(saved.word, saved.definition);
          return saved.word;
        }

        const wordResponse = await fetch("https://random-word-api.herokuapp.com/word");
        const [word] = await wordResponse.json();

        const defResponse = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
        let definition = "No definition found.";
        if (defResponse.ok) {
          const data = await defResponse.json();
          if (data[0]?.meanings[0]?.definitions[0]?.definition) {
            definition = data[0].meanings[0].definitions[0].definition;
          }
        }

        localStorage.setItem("wordOfTheDay", JSON.stringify({ date: today, word, definition }));
        displayWord(word, definition);
        return word;
      } catch (err) {
        document.getElementById("wordBox").textContent = "Error fetching word.";
        return null;
      }
    }

    function displayWord(word, definition) {
      document.getElementById("wordBox").textContent = word;
      document.getElementById("definition").textContent = definition;
    }

    // Submit a response
    async function submitResponse(word) {
      const name = document.getElementById("nameSelect").value;
      const text = document.getElementById("responseInput").value.trim();
      if (!text) return;

      await db.collection("responses").add({
        word,
        name,
        text,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      document.getElementById("responseInput").value = "";
    }

    // Show response history
    function loadHistory() {
      db.collection("responses")
        .orderBy("timestamp", "desc")
        .onSnapshot(snapshot => {
          const historyList = document.getElementById("historyList");
          historyList.innerHTML = "";
          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement("div");
            div.className = "entry";
            div.innerHTML = `<strong>${data.word} â€“ ${data.name}</strong>${data.text}`;
            historyList.appendChild(div);
          });
        });
    }

    // Main
    (async () => {
      const word = await getWordOfTheDay();
      document.getElementById("submitBtn").addEventListener("click", () => submitResponse(word));
      loadHistory();
    })();
  </script>
</body>
</html>
