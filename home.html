 <!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="style.css"> 
  <title>Word of the Day</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    .word { font-size: 2rem; font-weight: bold; margin: 20px 0; }
    .definition { font-size: 1.2rem; color: #444; margin-bottom: 30px; }
    .response-box { margin: 20px auto; width: 80%; max-width: 600px; }
    textarea { width: 100%; height: 100px; padding: 10px; font-size: 1rem; border-radius: 6px; border: 1px solid #ccc; margin-top: 5px; }
    select, button { margin-top: 10px; padding: 8px 12px; font-size: 1rem; }
    .history { margin-top: 40px; text-align: left; max-width: 700px; margin-left: auto; margin-right: auto; }
    .entry { border-bottom: 1px solid #ddd; padding: 10px 0; }
    .entry strong { display: block; margin-bottom: 5px; }
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <h1>Word of the Day</h1>
  <div class="word" id="wordBox">Loading...</div>
  <div class="definition" id="definition"></div>

  <button onclick="getRandomWord()">Refresh Word</button>

  <!-- Shared response form -->
  <div class="response-box">
    <label for="nameSelect"><strong>Who are you?</strong></label>
    <select id="nameSelect">
      <option value="Selene">Selene</option>
      <option value="Angelica">Angelica</option>
    </select>

    <textarea id="responseInput" placeholder="Write your thoughts..."></textarea>
    <br>
    <button id="submitBtn">Submit</button>
  </div>

  <!-- History section -->
  <div class="history">
    <h2>Response History</h2>
    <div id="historyList"></div>
  </div>

  <script>
    // ðŸ”¹ Replace with your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCSIO3qjNhXbnwq9D_-L4jT8p1t1izqf9Y",
      authDomain: "nemoydemo.firebaseapp.com",
      projectId: "nemoydemo",
      storageBucket: "nemoydemo.firebasestorage.app",
      messagingSenderId: "396078882117",
      appId: "1:396078882117:web:82f885e49eb6d3c556722c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

  let currentWord = ""; 

  async function getRandomWord() {
    try {
      const response = await fetch("https://random-word-api.herokuapp.com/word");
      const data = await response.json();
      currentWord = data[0];
      document.getElementById("wordBox").textContent = currentWord;

      // fetch definition from dictionary API
      fetchDefinition(currentWord);

      return currentWord; 
    } catch (error) {
      document.getElementById("wordBox").textContent = "Error fetching word ðŸ˜¢";
      console.error(error);
    }
  }

  async function fetchDefinition(word) {
    try {
      const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
      if (!res.ok) throw new Error("Definition not found");

      const data = await res.json();
      const meaning = data[0]?.meanings[0]?.definitions[0]?.definition || "No definition available.";
      document.getElementById("definition").textContent = meaning;
    } catch (error) {
      document.getElementById("definition").textContent = "No definition found ðŸ˜¢";
      console.error(error);
    }
  }

  function displayWord(word, definition) {
    currentWord = word; // make sure currentWord is updated if you display manually
    document.getElementById("wordBox").textContent = word;
    document.getElementById("definition").textContent = definition;
  }

  async function submitResponse() {
    const name = document.getElementById("nameSelect").value;
    const text = document.getElementById("responseInput").value.trim();
    if (!text) return;

    await db.collection("responses").add({
      word: currentWord, // always use the most recent word
      name,
      text,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });

    document.getElementById("responseInput").value = "";
  }


    // Show response history
    function loadHistory() {
      db.collection("responses")
        .orderBy("timestamp", "desc")
        .onSnapshot(snapshot => {
          const historyList = document.getElementById("historyList");
          historyList.innerHTML = "";
          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement("div");
            div.className = "entry";
            div.innerHTML = `<strong>${data.word} â€“ ${data.name}</strong>${data.text}`;
            historyList.appendChild(div);
          });
        });
    }

    // Main
    (async () => {
      const word = await getRandomWord();
      document.getElementById("submitBtn").addEventListener("click", () => submitResponse(word));
      loadHistory();
    })();
  </script>
</body>
</html>
