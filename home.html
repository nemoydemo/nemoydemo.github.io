<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="style.css"> 
  <link rel="icon" href="bread.ico" type="image/x-icon">
  <title>Word of the Day</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    .word { font-size: 2rem; font-weight: bold; margin: 20px 0; }
    .definition { font-size: 1.2rem; color: #444; margin-bottom: 30px; }
    .response-box { margin: 20px auto; width: 80%; max-width: 600px; }
    textarea { width: 100%; height: 100px; padding: 10px; font-size: 1rem; border-radius: 6px; border: 1px solid #ccc; margin-top: 5px; }
    select, button { margin-top: 10px; padding: 8px 12px; font-size: 1rem; }
    .history { margin-top: 40px; text-align: left; max-width: 700px; margin-left: auto; margin-right: auto; }
    .entry { border-bottom: 1px solid #ddd; padding: 10px 0; }
    .entry strong { display: block; margin-bottom: 5px; }

    /* Clocks */
    .clocks-container {
      position: absolute;
      top: 10px;
      left: 10px;
      display: flex;
      flex-direction: row;
      z-index: 9999;
    }
    .clock-frame {
      border: none;
      width: 250px;
      height: 200px;
      transform: scale(0.5);
      transform-origin: top left;
      margin-right: -100px; 
    }

    /* Audio top-right */
    .top-right {
      position: absolute; 
      top: 18px;          
      right: 300px;        
    }
    .top-right audio {
      height: 20px;
      width: 250px;
    }

    /* Countdown */
    .countdown-container {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #0d1b2a;
      padding: 8px 12px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      font-family: Arial, sans-serif;
      font-size: 14px;
      z-index: 9999;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #FFFFFF;
      font-weight: bold;
    }

    .countdown-title {
      white-space: nowrap;
    }

    /* Horizontal line */
    .horizontal-line {
      position: absolute;  
      top: 125px;       
      left: 0;
      width: 100%;      
      height: 2px;      
      background-color: #25334d; 
      z-index: 9999;    
    }

    /* Mood sliders at top */
    .mood-slider-label {
      font-size: 12px; 
      color: #25334d; 
      font-weight: bold;
      margin-right: 4px;
    }
    .mood-slider {
      width: 120px;
      margin-right: 20px;
    }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>

<body>

<!-- Mood Sliders Container -->
<div class="slider-container">
  <div class="slider-group">
    <!-- AngÃ©lica -->
    <div>
      <label for="angelicaMood">AngÃ©lica</label>
      <input type="range" id="angelicaMood" min="1" max="10" step="1" class="mood-slider">
      <div class="slider-steps">
        <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
        <span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
      </div>
    </div>

    <!-- Selene -->
    <div>
      <label for="seleneMood">Selene</label>
      <input type="range" id="seleneMood" min="1" max="10" step="1" class="mood-slider">
      <div class="slider-steps">
        <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
        <span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
      </div>
    </div>
  </div>

  <!-- Title -->
  <div class="slider-title">
    Nivel de perro
  </div>
</div>

<style>
/* Container */
.slider-container {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  z-index: 9999;
  padding: 6px 12px;
  background: rgba(0,0,0,0.2);
  border-radius: 8px;
  font-family: sans-serif;
}

/* Flex layout for sliders */
.slider-group {
  display: flex;
  gap: 20px;
  justify-content: center;
  align-items: flex-start;
}

/* Labels */
.slider-container label {
  color: #ffffff;
  font-size: 11px;
  display: block;
  margin-bottom: 4px;
}

/* Mood slider - base track */
.mood-slider {
  width: 150px;
  height: 6px;
  border-radius: 3px;
  background: #555;
  outline: none;
  appearance: none;
  -webkit-appearance: none;
}

/* Webkit thumb (Chrome, Safari, iOS) */
.mood-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #ffffff;
  border: 2px solid #4caf50;
  cursor: pointer;
  margin-top: -4px; /* centers thumb */
  position: relative;
  z-index: 3;
}

/* Firefox thumb */
.mood-slider::-moz-range-thumb {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #ffffff;
  border: 2px solid white;
  cursor: pointer;
}

/* IE/Edge thumb */
.mood-slider::-ms-thumb {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #ffffff;
  border: 2px solid #4caf50;
  cursor: pointer;
}

/* Steps below slider */
.slider-steps {
  display: flex;
  justify-content: space-between;
  font-size: 9px;
  color: #ffffff;
  margin-top: 2px;
  width: 150px;
}

/* Title */
.slider-title {
  margin-top: 12px;
  font-size: 14px;
  color: #ffffff;
  font-weight: bold;
}
</style>

<script>
const angelicaMood = document.getElementById("angelicaMood");
const seleneMood = document.getElementById("seleneMood");

// Load saved values (default = 5)
angelicaMood.value = localStorage.getItem("moodAngelica") || 5;
seleneMood.value = localStorage.getItem("moodSelene") || 5;

// Save & update color
angelicaMood.addEventListener("input", () => {
  localStorage.setItem("moodAngelica", angelicaMood.value);
  updateSliderTrack(angelicaMood);
});
seleneMood.addEventListener("input", () => {
  localStorage.setItem("moodSelene", seleneMood.value);
  updateSliderTrack(seleneMood);
});

function updateSliderTrack(slider) {
  const percentage = ((slider.value - 1) / 9) * 100;
  slider.style.background = `linear-gradient(to right, #25334d 0%, #25334d ${percentage}%, #555 ${percentage}%, #555 100%)`;
}

// Init
updateSliderTrack(angelicaMood);
updateSliderTrack(seleneMood);
</script>


  <!-- Redirect button -->
  <div style="text-align: right; margin: 12px 0;">
    <button id="redirectBtn" style="
        background-color: #25334d;
        color: white;
        padding: 5px 10px;
        border: none;
        border-radius: 8px;
        font-size: 12px;
        cursor: pointer;
    ">Play Go</button>
  </div>

  <script>
    document.getElementById('redirectBtn').addEventListener('click', () => {
      window.location.href = 'go.html';
    });
  </script>

  <!-- Audio -->
  <div class="top-right">
    <audio controls>
      <source src="almost-monday.mp3" type="audio/mpeg">
    </audio>
  </div>

  <!-- Horizontal line -->
  <div class="horizontal-line"></div>
  <br><br><br><br><br><br>
  <h1>Word of the Day</h1>

  <!-- Clocks -->
  <div class="clocks-container">
    <iframe
      class="clock-frame"
      src="https://worlddatetime.com/embed/simple-analog-clock.php?tz=America/Bogota&lbl=MedellÃ­n"
      scrolling="no" allowtransparency="true">
    </iframe>

    <iframe
      class="clock-frame"
      src="https://worlddatetime.com/embed/simple-analog-clock.php?tz=Europe/Madrid&lbl=Madrid"
      scrolling="no" allowtransparency="true">
    </iframe>
  </div>

  <!-- Countdown -->
  <div class="countdown-container">
    <div class="countdown-title">Days left until reunion: </div>
    <div id="countdown">Loading...</div>
  </div>

  <script>
    const targetDate = new Date(new Date().getFullYear(), 8, 9, 0, 0, 0); // Sept 9

    function updateCountdown() {
      const now = new Date();
      let diff = targetDate - now;

      if (diff <= 0) {
        document.getElementById("countdown").innerHTML = "ðŸŽ‰ It's September 9! ðŸŽ‰";
        clearInterval(interval);
        return;
      }

      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const minutes = Math.floor((diff / (1000 * 60)) % 60);
      const seconds = Math.floor((diff / 1000) % 60);

      document.getElementById("countdown").innerHTML =
        `${days}d ${hours}h ${minutes}m ${seconds}s`;
    }

    const interval = setInterval(updateCountdown, 1000);
    updateCountdown();
  </script>

  <!-- Word of the Day -->
  <div class="word" id="wordBox">Loading...</div>
  <div class="definition" id="definition"></div>
  <button onclick="getRandomWord()">Refresh Word</button>

  <!-- Response form -->
  <div class="response-box">
    <label for="nameSelect"><strong>Who are you?</strong></label>
    <select id="nameSelect">
      <option value="Selene">Selene</option>
      <option value="Angelica">AngÃ©lica</option>
    </select>

    <textarea id="responseInput" placeholder="Write your thoughts..."></textarea>
    <br>
    <button id="submitBtn">Submit</button>
  </div>

  <!-- History -->
  <div class="history">
    <h2>Response History</h2>
    <div id="historyList"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCSIO3qjNhXbnwq9D_-L4jT8p1t1izqf9Y",
      authDomain: "nemoydemo.firebaseapp.com",
      projectId: "nemoydemo",
      storageBucket: "nemoydemo.firebasestorage.app",
      messagingSenderId: "396078882117",
      appId: "1:396078882117:web:82f885e49eb6d3c556722c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentWord = ""; 

    async function getRandomWord() {
      try {
        const response = await fetch("https://random-word-api.vercel.app/api?count=1");
        const data = await response.json();
        currentWord = data[0];
        document.getElementById("wordBox").textContent = currentWord;
        fetchDefinition(currentWord);
        return currentWord; 
      } catch (error) {
        document.getElementById("wordBox").textContent = "Error fetching word ðŸ˜¢";
        console.error(error);
      }
    }

    async function fetchDefinition(word) {
      try {
        const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
        if (!res.ok) throw new Error("Definition not found");
        const data = await res.json();
        const meaning = data[0]?.meanings[0]?.definitions[0]?.definition || "No definition available.";
        document.getElementById("definition").textContent = meaning;
      } catch (error) {
        document.getElementById("definition").textContent = "No definition found ðŸ˜¢";
        console.error(error);
      }
    }

    async function submitResponse() {
      const name = document.getElementById("nameSelect").value;
      const text = document.getElementById("responseInput").value.trim();
      if (!text) return;

      await db.collection("responses").add({
        word: currentWord,
        name,
        text,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      document.getElementById("responseInput").value = "";
    }

    function addCommentBox(docId, entryDiv) {
      const wrapper = document.createElement("div");
      wrapper.style.marginTop = "10px";
      wrapper.style.paddingLeft = "10px";
      wrapper.style.borderLeft = "2px solid #25334d";

      const commentsDiv = document.createElement("div");
      commentsDiv.id = `comments-${docId}`;
      wrapper.appendChild(commentsDiv);

      const commentBox = document.createElement("div");
      commentBox.innerHTML = `
        <textarea id="commentInput-${docId}" 
                  placeholder="Write a comment..." 
                  style="width:90%;height:30px;font-size:0.85rem;padding:4px;margin-top:6px;background-color:#4f5f7d;"></textarea>
        <br>
        <button onclick="submitComment('${docId}')" 
                style="margin-top:4px;padding:4px 8px;font-size:0.8rem;border-radius:4px;cursor:pointer;background-color:#4f5f7d";>
          Comment
        </button>
      `;
      wrapper.appendChild(commentBox);

      entryDiv.appendChild(wrapper);

      db.collection("responses").doc(docId).collection("comments")
        .orderBy("timestamp", "asc")
        .onSnapshot(snapshot => {
          commentsDiv.innerHTML = "";
          snapshot.forEach(c => {
            const cData = c.data();
            const p = document.createElement("p");
            p.style.margin = "3px 0";
            p.style.fontSize = "0.9rem";
            p.innerHTML = `<em>${cData.name || "Anon"}:</em> ${cData.text}`;
            commentsDiv.appendChild(p);
          });
        });
    }

    async function submitComment(docId) {
      const input = document.getElementById(`commentInput-${docId}`);
      const text = input.value.trim();
      if (!text) return;

      await db.collection("responses").doc(docId).collection("comments").add({
        name: document.getElementById("nameSelect").value,
        text,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      input.value = "";
    }

    function loadHistory() {
      db.collection("responses")
        .orderBy("timestamp", "desc")
        .onSnapshot(snapshot => {
          const historyList = document.getElementById("historyList");
          historyList.innerHTML = "";

          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement("div");
            div.className = "entry";

            const nameHtml = `<strong>${data.word} â€“ ${data.name}</strong>`;
            let content = "";

            const spotifyRegex = /(https?:\/\/open\.spotify\.com\/[^\s]+)/;
            const youtubeRegex = /(https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([^\s&]+)|https?:\/\/youtu\.be\/([^\s&]+))/;

            if (spotifyRegex.test(data.text)) {
              const match = data.text.match(spotifyRegex);
              const embedUrl = match[1].replace("open.spotify.com", "open.spotify.com/embed");

              content = `<iframe style="border-radius:12px"
                          src="${embedUrl}"
                          width="50%"
                          height="100"
                          frameborder="0"
                          allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">
                        </iframe>`;
            } else if (youtubeRegex.test(data.text)) {
              const match = data.text.match(youtubeRegex);
              const videoId = match[2] || match[3];
              const embedUrl = `https://www.youtube.com/embed/${videoId}`;

              content = `<iframe width="560" height="315"
                          src="${embedUrl}"
                          frameborder="0"
                          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                          allowfullscreen>
                        </iframe>`;
            } else {
              content = `<span>${data.text}</span>`;
            }

            div.innerHTML = `${nameHtml}<br>${content}`;
            historyList.appendChild(div);
            addCommentBox(doc.id, div);
          });
        });
    }

    (async () => {
      const word = await getRandomWord();
      document.getElementById("submitBtn").addEventListener("click", () => submitResponse(word));
      loadHistory();
    })();
  </script>
</body>
</html>
